{"version":3,"sources":["../src/google.js"],"names":["getAuthPayload","appId","user","profile","getBasicProfile","authResponse","getAuthResponse","type","id","getId","firstName","getGivenName","lastName","getFamilyName","email","getEmail","clientId","token","id_token","init","scope","fetchBasicProfile","then","load","bluebird","promisify","window","gapi","auth2","getAuthInstance","client_id","_","trimEnd","fetch_basic_profile","onClick","onSuccess","isSignedIn","get","currentUser","signIn"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA,IAAIA,cAAc,GAAG,SAAjBA,cAAiB,CAACC,KAAD,EAAQC,IAAR,EAAiB;AACpC,MAAIC,OAAO,GAAGD,IAAI,CAACE,eAAL,EAAd;AACA,MAAIC,YAAY,GAAGH,IAAI,CAACI,eAAL,EAAnB;AACA,SAAO;AACLC,IAAAA,IAAI,EAAE,QADD;AAELJ,IAAAA,OAAO,EAAE;AACPK,MAAAA,EAAE,EAAEL,OAAO,CAACM,KAAR,EADG;AAEPC,MAAAA,SAAS,EAAEP,OAAO,CAACQ,YAAR,EAFJ;AAGPC,MAAAA,QAAQ,EAAET,OAAO,CAACU,aAAR,EAHH;AAIPC,MAAAA,KAAK,EAAEX,OAAO,CAACY,QAAR;AAJA,KAFJ;AAQLV,IAAAA,YAAY,EAAE;AACZW,MAAAA,QAAQ,EAAEf,KADE;AAEZgB,MAAAA,KAAK,EAAEZ,YAAY,CAACa;AAFR;AART,GAAP;AAaD,CAhBD;;AAkBO,IAAIC,IAAI,GAAG,SAAPA,IAAO,OAIZ;AAAA,MAHJlB,KAGI,QAHJA,KAGI;AAAA,wBAFJmB,KAEI;AAAA,MAFJA,KAEI,2BAFI,eAEJ;AAAA,mCADJC,iBACI;AAAA,MADJA,iBACI,sCADgB,IAChB;AACJ,0BAAW,iBAAX,EAA8B,wCAA9B,EAAwEC,IAAxE,CACE,YAAM;AACJ,QAAIC,IAAI,GAAGC,qBAASC,SAAT,CAAmBC,MAAM,CAACC,IAAP,CAAYJ,IAA/B,CAAX;;AACAA,IAAAA,IAAI,CAAC,OAAD,CAAJ,CAAcD,IAAd,CAAmB,YAAM;AACvB,UAAI,CAACI,MAAM,CAACC,IAAP,CAAYC,KAAZ,CAAkBC,eAAlB,EAAL,EAA0C;AACxCH,QAAAA,MAAM,CAACC,IAAP,CAAYC,KAAZ,CAAkBT,IAAlB,CAAuB;AACrBW,UAAAA,SAAS,EAAEC,eAAEC,OAAF,CAAU/B,KAAV,EAAiB,6BAAjB,CADU;AAErBgC,UAAAA,mBAAmB,EAAEZ,iBAFA;AAGrBD,UAAAA,KAAK,EAALA;AAHqB,SAAvB;AAKD;AACF,KARD;AASD,GAZH;AAcD,CAnBM;;;;AAqBA,IAAIc,OAAO,GAAG,SAAVA,OAAU,QAA0B;AAAA,MAAvBjC,KAAuB,SAAvBA,KAAuB;AAAA,MAAhBkC,SAAgB,SAAhBA,SAAgB;AAC7C,MAAIP,KAAK,GAAGF,MAAM,CAACC,IAAP,CAAYC,KAAZ,CAAkBC,eAAlB,EAAZ;;AACA,MAAID,KAAK,CAACQ,UAAN,IAAoBR,KAAK,CAACQ,UAAN,CAAiBC,GAAjB,EAAxB,EAAgD;AAC9C,QAAInC,IAAI,GAAG0B,KAAK,CAACU,WAAN,CAAkBD,GAAlB,EAAX;AACAF,IAAAA,SAAS,CAACnC,cAAc,CAACC,KAAD,EAAQC,IAAR,CAAf,CAAT;AACD,GAHD,MAGO;AACL0B,IAAAA,KAAK,CAACW,MAAN,GAAejB,IAAf,CAAoB,UAAApB,IAAI,EAAI;AAC1BiC,MAAAA,SAAS,CAACnC,cAAc,CAACC,KAAD,EAAQC,IAAR,CAAf,CAAT;AACD,KAFD;AAGD;AACF,CAVM","sourcesContent":["import _ from 'lodash/fp'\nimport { loadScript } from './common'\nimport bluebird from 'bluebird'\n\nlet getAuthPayload = (appId, user) => {\n  let profile = user.getBasicProfile()\n  let authResponse = user.getAuthResponse()\n  return {\n    type: 'google',\n    profile: {\n      id: profile.getId(),\n      firstName: profile.getGivenName(),\n      lastName: profile.getFamilyName(),\n      email: profile.getEmail(),\n    },\n    authResponse: {\n      clientId: appId,\n      token: authResponse.id_token,\n    },\n  }\n}\n\nexport let init = ({\n  appId,\n  scope = 'profile email',\n  fetchBasicProfile = true,\n}) => {\n  loadScript('google-platform', 'https://apis.google.com/js/platform.js').then(\n    () => {\n      let load = bluebird.promisify(window.gapi.load)\n      load('auth2').then(() => {\n        if (!window.gapi.auth2.getAuthInstance()) {\n          window.gapi.auth2.init({\n            client_id: _.trimEnd(appId, '.apps.googleusercontent.com'),\n            fetch_basic_profile: fetchBasicProfile,\n            scope,\n          })\n        }\n      })\n    }\n  )\n}\n\nexport let onClick = ({ appId, onSuccess }) => {\n  let auth2 = window.gapi.auth2.getAuthInstance()\n  if (auth2.isSignedIn && auth2.isSignedIn.get()) {\n    let user = auth2.currentUser.get()\n    onSuccess(getAuthPayload(appId, user))\n  } else {\n    auth2.signIn().then(user => {\n      onSuccess(getAuthPayload(appId, user))\n    })\n  }\n}\n"],"file":"google.js"}